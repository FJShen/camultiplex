<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>camultiplex: Main Page</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">camultiplex Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The format of this markdown file is best manifested when the file is rendered in HTML format.</p>
<h1>camultiplex</h1>
<p>This project is developed in catkin workspace, aimed at utilizing <b>multi-thread processing</b> and taking advantage from the <b>nodelet</b>. Data are sent via <b>multiple channels</b> in the form of ROS messages.</p>
<p>This package can either be configured to run as <b>nodelets</b> on a single computer or as independent nodes across a computer network.</p>
<hr/>
<p>Nodelets under a same nodelet manager share the common memory space, which eliminates the need to copy data from one node to the other. This is especially useful when the computation is heavy. This sharing of memory is enabled by using <code>SharedPtr</code> on the lower level, a feature of modern C++.</p>
<p>To prevent the throughput from being throttled by the performance of a single CPU core, multiple threads can be utilized which are expected to run on as many cores as the machine possesses. This is made possible by defining more than one subscriber-publisher pairs, each of them communicating on their own channel (aka. ROS topic). When a source node owns multiple publishers, it rotationally lets different publishers to publish the message, which in turn, appears on different channels. In order to ensure that all messages are received by the drain node, it is necessary to let the drain has as many subscribers as the number of publishers.</p>
<p>Based on observation, two channels (2*RGB + 2*Depth) shall be enough for 60 FPS 640*480 pixel resolution.</p>
<hr/>
 <h2>Dependencies</h2>
<p>ROS and catkin (comes with ROS)</p>
<p>Boost::thread, Boost::filesystem, Boost::chrono</p>
<p>OpenCV</p>
<hr/>
<h2>Compilation of code</h2>
<pre>
cd <em>your_catkin_workspace_directory</em>/src
git clone <a href="http://github.com/FJShen/camultiplex">http://github.com/FJShen/camultiplex</a>
git checkout master</pre><pre>cd <em>your_catkin_workspace_directory</em>
catkin_make --pkg camultiplex
</pre><p>This is what your directory should typically look like (note that before you call catkin_make, 'src' might be the only directory that you see in the workspace):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;nvidia@virtual-ubuntu:~/catkin_ws$ tree -L 2</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;├── build</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;│   └── &lt;i&gt;Some files&lt;/i&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;├── devel</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;│   └── &lt;i&gt;Some files&lt;/i&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;├── install</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;│   └── &lt;i&gt;Some files&lt;/i&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;└── src</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    ├──&lt;b&gt; camultiplex &lt;/b&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    └──&lt;i&gt; other packets &lt;/i&gt;</div></div><!-- fragment --><hr/>
<h2>Execution of nodes</h2>
<h3>I. Nodelets mode</h3>
<h4>Launchfile method (roslaunch)</h4>
<ol type="1">
<li>bring up everything at once <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch camultiplex launch_everything.launch</div></div><!-- fragment --></li>
</ol>
<p>You need to configure the parameters in the files <code>./launch/source.launch</code> and <code>./launch/drain.launch</code> respectively.</p>
<p>By your calling <code>roslaunch</code>, <code>roscore</code> is automatically called. </p><hr/>
<h4>Command Line method (rosrun)</h4>
<ol type="1">
<li>summon the master <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roscore</div></div><!-- fragment --></li>
<li>bring up nodelet manager <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun nodelet nodelet manager __name:=nodelet_manager</div></div><!-- fragment --></li>
<li>load camera drain as a nodelet to be managed by nodelet_manager <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun nodelet nodelet load camultiplex/drain nodelet_manager _diversity:=2 _base_path:=&quot;/media/nvidia/ExtremeSSD&quot;</div></div><!-- fragment --></li>
<li>load camera source as a nodelet to be managed by nodelet_manager <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun nodelet nodelet load camultiplex/source nodelet_manager _diversity:=2 _FPS:=60 _align:=true</div></div><!-- fragment --> <hr/>
</li>
</ol>
<h3>II. Independent nodes mode</h3>
<h4>Launchfile method (roslaunch)</h4>
<ol type="1">
<li>bring up camera drain <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch camultiplex independent_drain.launch</div></div><!-- fragment --></li>
<li>bring up camera source <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roslaunch camultiplex independent_source.launch</div></div><!-- fragment --></li>
</ol>
<p>You need to configure the parameters in the files <code>./launch/independent_source.launch</code> and <code>./launch/independent_drain.launch</code> respectively.</p>
<p>By your calling <code>roslaunch</code>, <code>roscore</code> is automatically called. </p><hr/>
<h4>Command Line method (rosrun)</h4>
<ol type="1">
<li>summon the master <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;roscore</div></div><!-- fragment --></li>
<li>bring up camera drain <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun camultiplex independent_drain _diversity:=2 _base_path:=&quot;/media/nvidia/ExtremeSSD&quot;</div></div><!-- fragment --></li>
<li>bring up camera source <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun camultiplex independent_source _diversity:=2 _FPS:=60 _align:=true</div></div><!-- fragment --> <hr/>
</li>
</ol>
<h4>*Running independent nodes on different hosts in LAN</h4>
<p>When running a set of nodes that span across a network (e.g. LAN), <code>roscore</code> only need to be called on one host (i.e. there is only one master in the network).</p>
<p>Suppose we have two hosts (computers): H1 (192.168.0.11) and H2 (192.168.0.22); we want the master to be run on H1:</p>
<ol type="1">
<li>On H1 and H2 separately <code>export ROS_IP=[own_ip_address]</code> (this step might not be needed)</li>
<li>On H2 <code>export ROS_MASTER_URI=<a href="http://">http://</a>[h1_ip_addr]:11311</code> (i.e. export ROS_MASTER_URI=<a href="http://192.168.0.11:11311">http://192.168.0.11:11311</a>).</li>
<li>Call <code>roscore</code> only on H1.</li>
<li>On H1 and H2 separately bring up ROS nodes. Message will be transmitted in the form of TCP (or UDP) packets.</li>
</ol>
<p>Notes:</p>
<ol type="1">
<li>A node can coexist and talk with a nodelet, whether they are on a same or different host.</li>
<li>Two nodelets <em>can</em> talk with each other on different hosts in LAN, however they will not benefit from the shared-memory mechanism, and extra work has to be done to ensure their nodelet managers have distinct names. <hr/>
</li>
</ol>
<h2>Table of Parameters</h2>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Type </th><th>User configurable? </th><th>Where to configure </th><th>Usage  </th></tr>
<tr>
<td><em>drain</em>/diversity </td><td>int </td><td>Yes </td><td>Drain side </td><td>Number of subscribers that a drain uses (1),(2) </td></tr>
<tr>
<td><em>drain</em>/base_path </td><td>string </td><td>Yes </td><td>Drain side </td><td>Path for the drain to store images </td></tr>
<tr>
<td><em>source</em>/diversity </td><td>int </td><td>Yes </td><td>Source side </td><td>Number of publishers that a source uses (1),(3) </td></tr>
<tr>
<td><em>source</em>/FPS </td><td>int </td><td>Yes </td><td>Source side </td><td>Frames-per-second of the camera </td></tr>
<tr>
<td><em>source</em>/align </td><td>bool </td><td>Yes </td><td>Source side </td><td>Align depth image to RGB image </td></tr>
<tr>
<td>/rs_start_time </td><td>string </td><td>No </td><td>Global parameter set by source node at runtime </td><td>Unix time of when the camera was started </td></tr>
</table>
<p>Comments:</p>
<p>1) Drain diversity should be no less than source diversity lest some active topics not be subscribed by the drain</p>
<p>2) The number of subscribers are counted in pairs of RGB-Depth subscribers - therefore 1 RGB subscriber and 1 Depth subscriber are counted as "one" subscriber in the context of diversity.</p>
<p>3) Referring to (2), the same logic applies to publishers. </p><hr/>
<h2>Generation of documentation</h2>
<p>In the package's directory (camultiplex/) call:</p>
<p><code>rosdoc_lite .</code></p>
<p>Doxygen will be called and the documentation mainpage will be located at <code>camultiplex/doc/html/index.html</code>.</p>
<p>Notes:</p>
<ol type="1">
<li>It has been noticed by the developer that <code>rosdoc_lite</code> only adds new files and modifies existing files in the /doc directory, but never removes obsolete files (E.g., you rename a class from A_old to A_new, so A_old no longer exists as class; after calling <code>rosdoc_lite</code>, the HTML files for A_new is added to the /doc directory, but the files for A_old still remain.). Therefore, it is recommended that the developer manually remove all obsolete files in /doc after he refactors the code.</li>
</ol>
<dl class="section see"><dt>See also</dt><dd><a href="http://wiki.ros.org/rosdoc_lite">http://wiki.ros.org/rosdoc_lite</a> <hr/>
</dd></dl>
<h2>Contact</h2>
<p>Fangjia Shen (<a href="#" onclick="location.href='mai'+'lto:'+'she'+'n4'+'49@'+'pu'+'rdu'+'e.'+'edu'; return false;">shen4<span style="display: none;">.nosp@m.</span>49@p<span style="display: none;">.nosp@m.</span>urdue<span style="display: none;">.nosp@m.</span>.edu</a>) Purdue University School of Electrical &amp; Computer Engineering </p>
</div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/camultiplex">camultiplex</a><br />
Author(s): Fangjia Shen <shen449@purdue.edu></br />
<small>autogenerated on Thu May 28 2020 12:21:53</small>
</div>
</body>
</html>
